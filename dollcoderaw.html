<script>
  const charmap = ["▌", "▖", "▘"];
  
	// Generate dollcode
	
		// 'number' is the return from parseInt()
		// so the decimal representation of the input id
	const genCode = (number) => {
    const output = [];
		// Representation of the input number as the 'window' of which places to check
			// 1081699353
    let window = number;
    // Max length protection
		let loopProtection = 1000;

																	// originally > 0,
																	// but >= 1 makes more sense to me
		while (loopProtection > 0 && window >= 1) {
      // Modulous of current place
			const mod = window % 3;

			if (mod == 0) {
				// subtract 3 to ensure division is clean
				// divide by 3 to shift place
				console.log(`${window} %3 = ${mod} => ${charmap[mod]}`)
        window = (window - 3) / 3;
				console.log(window)
      }
			
			else {
				// subtract mod to ensure division is clean
				// divide by 3 to shift place
        console.log(`${window} %3 = ${mod} => ${charmap[mod]}`)
				window = (window - mod) / 3;
				console.log(window)
      }

			// Add according ▌▖▘ to beginning of output array based on the mod
			// If mod == 0, add ▌ becase perfectly divisible by 3
			output.unshift(charmap[mod]);
      	// arr.unshift adds to the beginning of the array
					// lookup character in charmap according to mod

      // Decrement max length
			loopProtection--;
    }

		// Return string from array
    console.log(output.join(""))
		return output.join("");
  };

  const parseDollcode = (dollcode) => {
    // reverse the nibs! [sic]
		// have to reverse the input code to build from the smallest place to largest
		// (1 > 3 > 9 > 27 > ...)
    const nibs = dollcode.trim().split("").reverse();
			// trim whitespace, split between characters, reverse the returned array

    console.log({ nibs });

    return nibs
			// map returns and array populated by the returns of calling a provided function on every item
			// return 1, 2, or 3 depending on nib
			// i.e. ["▖", "▘", "▌"] becomes [1, 2, 3]
      .map((nib) => (nib === "▖" ? 1 : nib === "▘" ? 2 : 3))
			// reduce calls a provided 'reducer' function sequnetially, passing the result of the previous into the next
      .reduce((acc, val, index) => {
					// acc   => accumulator  => resulting value of all previous calls
					// val   => currentValue => the value of the current item; always 1, 2, or 3
					// index => currentIndex => the position of currentValue in the away
        
				// value of the current place: [1,2,3] * 3^index
				const r = val * Math.pow(3, index);
        // return the new value to the next call of the reducer
				const res = r + acc;
        console.log({ acc, val, index, r, res });
        return res;
      }, 0);
			// extra 0 arg isnt required here, reduce can take 1 or 2 args
  };

	// Fill the output div
  const setOutput = (text) => {
    document.querySelector("#output").innerHTML = text;
  };

	// Check if 0x or 0d based on the state of the #hex radio button
  const getIDRadix = () => {
		// If hex is checked return 16, else return 10
    return document.querySelector("#hex").checked ? 16 : 10;
  };

	// Update whenever any input it changed, keyup, keypress (fixes mobile im guessing?), or keydown
  const updateEvent = () => {
		console.log('\n\n')
		
		// Value of input field
    const id = document.querySelector("#id").value;

		// If radio button for dollcode is selected
		// i.e. if the user is inputting dc
    if (document.querySelector("#dollcode").checked) {
      // Parse dc into a number
			const number = parseDollcode(id);
      console.log({ number });
      // Set the contents of the output to be ul containing 0d and 0x representations
			setOutput(
        `<ul>
					<li>dec: ${number.toString(10)}</li>
					<li>hex: ${number.toString(16)}</li>
				</ul>`
      );
    }
		// If 0d or 0x is selected, generate the dc
		else {
			// Parses a string depending on the radix*
			// i.e. parseInt('f', 16) => 15
			// getIDRadix returns 10 or 16 based on the state of the radio buttons
			const number = parseInt(id, getIDRadix());
      // Fill the output div with the returned dc
			setOutput(genCode(number));

			// * Radix is the number of digits to use, or base, or a number system
			// Decimal is radix 10, 0-9
			// Hex is radix 16, 0-f
			// etc
    }
  };

	// Update on changes to inputs
 	 document.querySelectorAll("input").forEach((x) => {
    x.addEventListener("change",   updateEvent);
    // x.addEventListener("keyup",    updateEvent);
    x.addEventListener("keypress", updateEvent);
    // x.addEventListener("keydown",  updateEvent);
  });
</script>
